
def getTarFileName(file) {
    String tarFile = '' + file + '-' + tallyuserVersion + '-assembly.tar.gz'
    return tarFile
}

def createUnzipTask(demoType, appName, tarPath) {
    return tasks.create("makeDockerImage${demoType}"){
        String appNameWithVersion = appName + '-' + tallyuserVersion
        String tarFile = getTarFileName(appName)
        copy {
            from tarTree(tarPath + tarFile)
            into binTarget
        }
        File finalDir = new File(binTarget + '/'+appName)
        finalDir.mkdirs()
        file(binTarget +'/'+appNameWithVersion).renameTo(new File(finalDir, '/app'))

        def dockerfileDir = new File( 'dockerfiles/'+appName )
        if(dockerfileDir.exists()){
            copy{
                from dockerfileDir
                into finalDir
            }
        }
    }
}

createUnzipTask('TallyUser', 'tallyuser-servo', './target/')

//createUnzipTask('ZookeeperRegistry', 'dubbo-registry-zookeeper', '../dubbo-registry/')
//createUnzipTask('RedisRegistry', 'dubbo-registry-redis', '../dubbo-registry/')
//createUnzipTask('DubboAdmin', 'dubbo-admin', '../')

//
//task s("tar${baseName}Artifact", Tar) {
//    compression = Compression.GZIP
//    from fromDir {
//        into toDir
//    }
//    extension = "tar.gz"
//    baseName = baseName
//    version = "${project.artifactVersion}"
//    dependsOn buildTask
//}